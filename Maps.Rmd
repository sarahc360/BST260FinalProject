---
title: "Maps"
output: html_document
---

```{r}
library(dplyr)
library(ggplot2)
library(RColorBrewer)
```


```{r}
full_dataset <-read.csv("data1.csv")
```


```{r}
OECD_label <- c("Australia", "Austria", "Belgium", "Canada", "Chile", "Colombia", "Costa Rica", "Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", "Iceland", "Ireland", "Israel", "Italy", "Japan", "Korea", "Latvia", "Lithuania", "Luxembourg", "Mexico", "Netherlands", "New Zealand", "Norway", "Poland", "Portugal", "Slovak Republic", "Slovenia", "Spain", "Sweden", "Switzerland", "Turkey", "United Kingdom", "United States")

full_dataset_OECD <- full_dataset %>%
  filter (Country %in% OECD_label)
```



```{r}
library(tidyr)

# Isolate variables of interest
unpaid_time <- full_dataset_OECD %>%
  filter(Indicator == "Time spent in unpaid work, by sex") %>%
  select(Country, Sex, Age.Group, Time, Value) %>%
  rename(unpaid_time = Value)

total_time <- full_dataset_OECD %>%
  filter(Indicator == "Time spent in total work, by sex") %>%
  select(Country, Sex, Age.Group, Time, Value) %>%
  rename(total_time = Value)

women_in_parliament <- full_dataset_OECD %>%
  filter(Indicator == "Female share of seats in national parliaments") %>%
  select(Country, Sex, Age.Group, Time, Value) %>%
  rename(parliament_female_share_seats = Value)

female_managers <- full_dataset_OECD %>%
  filter(Indicator == "Share of female managers") %>%
  select(Country, Sex, Age.Group, Time, Value) %>%
  rename(female_managers = Value)

# Create new dataframe
merged_1 <- merge(unpaid_time, total_time, by=c("Country", "Sex", "Age.Group", "Time"))

merged_2 <- merge(female_managers,women_in_parliament, by=c("Country", "Sex", "Age.Group", "Time"))

# Create ratio variable
# create a comparison map 
new_unpaid_data <- merged_1 %>%
  mutate(prop_unpaid = (unpaid_time/total_time))
```

```{r}
#Proportion of unpaid work in OECD countries in 2020 
# Pulling out world map data frame
world_map = map_data("world")%>%
  rename(Country="region")
    
#Recoding names

country_key = data.frame(rbind(c("United Kingdom", "UK"), 
                               c("United States", "USA")))
names(country_key) = c("Merged1", "map")

# Create named vector for recoding country names
recode_map <- country_key$Merged1; names(recode_map) = country_key$map

# Recode country names in world map data to match with Merged1 Dataset
world_map <- world_map %>%
  mutate(Country = recode(Country, !!!recode_map))

Unpaid_map<- left_join(new_unpaid_data, world_map, by = "Country")

new_unpaid_map <- Unpaid_map%>% filter (!Country %in% c("Australia", "Canada", "Japan", "Korea", "United States", "Mexico", "New Zealand"))

women_labels <- new_unpaid_map %>%
  filter(Sex == "Women", prop_unpaid > 0.5) %>%
  group_by(Country) %>%
  summarize(lat = mean(lat),
            long = mean(long))

men_labels <- new_unpaid_map %>%
  filter(Sex == "Men", prop_unpaid > 0.5) %>%
  group_by(Country) %>%
  summarize(lat = mean(lat),
            long = mean(long))

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

#Proportion of time spent in unpaid work 
p1 <- new_unpaid_map %>% filter(Sex == "Women") %>%
  ggplot(aes(x = long, y = lat)) +
  geom_polygon(aes(fill = prop_unpaid, group = group), color = "black")+
  scale_color_manual(name = "Proportion of Unpaid Work by Women", values = cbPalette) +
  geom_text_repel(data = women_labels, aes(long, lat, label = Country), color = "orange") +
      theme(legend.position = "none",
        panel.grid.major = element_blank(), 
        panel.background = element_blank(),
        axis.title = element_blank(), 
        axis.text = element_blank(),
        axis.ticks = element_blank())


p2 <- new_unpaid_map %>% filter(Sex == "Men") %>%
  ggplot(aes(x = long, y = lat)) +
  geom_polygon(aes(fill = prop_unpaid, group = group), color = "black") +
    scale_colour_manual(name = "Proportion of Unpaid Work by Men", values = cbPalette) +
  geom_text_repel(data = men_labels, aes(long, lat, label = Country), color = "orange") +
      theme(panel.grid.major = element_blank(), 
        panel.background = element_blank(),
        axis.title = element_blank(), 
        axis.text = element_blank(),
        axis.ticks = element_blank())+
scale_fill_gradient(limits = c(0.05, 0.70), oob = scales::squish)
library(egg)
ggarrange(p1, p2, nrow = 1)
```

